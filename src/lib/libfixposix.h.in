#if !defined(_LIBFIXPOSIX_H_)
#define _LIBFIXPOSIX_H_

#include <stdlib.h>
#include <stdbool.h>
#include <inttypes.h>



typedef uint64_t lfp_flags_t;



#include <unistd.h>

#if !defined(O_CLOEXEC)
// Syscalls use "int" for passing flags, and since
// *nix systems use the LP64 memory model, "int" is 32 bits
// which means that we can allocate unsupported flags in the
// upper part of an lfp_flags_t value
# define O_CLOEXEC ( 1 >> 32 )
#endif

int lfp_pipe (int pipefd[2], lfp_flags_t flags);



#if defined(__linux__)
# if @HAVE_EMULATED_SIGNALFD@ // HAVE_EMULATED_SIGNALFD
struct signalfd_siginfo { unsigned int ssi_signo; };
# else
#  include <sys/signalfd.h>
# endif
#endif

int lfp_install_signalfd(int signum, int sa_flags, bool* blockp);

int lfp_uninstall_signalfd(int signum, bool block);



#include <sys/select.h>

int lfp_select(int nfds, fd_set *readfds, fd_set *writefds,
               fd_set *exceptfds, const struct timespec *timeout,
               const sigset_t *sigmask);

void lfp_fd_clr(int fd, fd_set *set);

bool lfp_fd_isset(int fd, fd_set *set);

void lfp_fd_set(int fd, fd_set *set);

void lfp_fd_zero(fd_set *set);



#include <sys/socket.h>

typedef enum {
#if defined(AF_UNIX)
    LFP_AF_UNIX = AF_UNIX,
#endif
#if defined(AF_LOCAL)
    LFP_AF_LOCAL = AF_LOCAL,
#endif
#if defined(AF_INET)
    LFP_AF_INET = AF_INET,
#endif
#if defined(AF_INET6)
    LFP_AF_INET6 = AF_INET6,
#endif
#if defined(AF_PACKET)
    LFP_AF_PACKET = AF_PACKET,
#endif
} lfp_socket_domain_t;

typedef enum {
#if defined(SOCK_STREAM)
    LFP_SOCK_STREAM = SOCK_STREAM,
#endif
#if defined(SOCK_DGRAM)
    LFP_SOCK_DGRAM = SOCK_DGRAM,
#endif
#if defined(SOCK_SEQPACKET)
    LFP_SOCK_SEQPACKET = SOCK_SEQPACKET,
#endif
#if defined(SOCK_RDM)
    LFP_SOCK_RDM = SOCK_RDM,
#endif
#if defined(SOCK_RAW)
    LFP_SOCK_RAW = SOCK_RAW,
#endif
} lfp_socket_type_t;

int lfp_socket(lfp_socket_domain_t domain,
               lfp_socket_type_t   type,
               int                 protocol,
               lfp_flags_t         flags);

#endif // _LIBFIXPOSIX_H_
